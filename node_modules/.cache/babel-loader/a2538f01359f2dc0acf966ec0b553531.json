{"ast":null,"code":"\"use strict\";\n/**\n * @file 地图核心组件\n * @author hedongran\n * @email hdr01@126.com\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.MapContext = void 0;\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\n\nvar common_1 = require(\"../common\");\n\nvar WrapperHOC_1 = tslib_1.__importDefault(require(\"../common/WrapperHOC\"));\n\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\n\nvar isString_1 = tslib_1.__importDefault(require(\"../utils/isString\"));\n\n;\nvar eventsMap = ['click', 'dblclick', 'rightclick', 'rightdblclick', 'maptypechange', 'mousemove', 'mouseover', 'mouseout', 'movestart', 'moving', 'moveend', 'zoomstart', 'zoomend', 'addoverlay', 'addcontrol', 'removecontrol', 'removeoverlay', 'clearoverlays', 'dragstart', 'dragging', 'dragend', 'addtilelayer', 'removetilelayer', 'load', 'resize', 'hotspotclick', 'hotspotover', 'hotspotout', 'tilesloaded', 'touchstart', 'touchmove', 'touchend', 'longpress'];\nvar methodsMap = {\n  enableScrollWheelZoom: ['enableScrollWheelZoom', 'disableScrollWheelZoom'],\n  enableDragging: ['enableDragging', 'disableDragging'],\n  enableDoubleClickZoom: ['enableDoubleClickZoom', 'disableDoubleClickZoom'],\n  enableKeyboard: ['enableKeyboard', 'disableKeyboard'],\n  enableInertialDragging: ['enableInertialDragging', 'disableInertialDragging'],\n  enableContinuousZoom: ['enableContinuousZoom', 'disableContinuousZoom'],\n  enablePinchToZoom: ['enablePinchToZoom', 'disablePinchToZoom'],\n  enableRotate: ['enableRotate', 'disableRotate'],\n  enableTilt: ['enableTilt', 'disableTilt'],\n  enableAutoResize: ['enableAutoResize', 'disableAutoResize']\n};\n;\nexports.MapContext = react_1.default.createContext({\n  // We provide a default function for Context without provider\n  map: undefined\n});\n\nvar Map =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(Map, _super);\n\n  function Map(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.el = react_1.default.createRef();\n    _this.options = ['minZoom', 'maxZoom', 'mapType'];\n    return _this;\n  }\n\n  Map.prototype.componentDidMount = function () {\n    this.initialize();\n    this.forceUpdate();\n  };\n\n  Map.prototype.componentDidUpdate = function (prevProps) {\n    var preCenter = prevProps.center,\n        preZoom = prevProps.zoom;\n    var _a = this.props,\n        center = _a.center,\n        zoom = _a.zoom;\n    var isCenterChanged = !!center && !shallowequal_1.default(preCenter, center);\n    var isZoomChanged = !!(zoom && !shallowequal_1.default(preZoom, zoom));\n    var centerPoint;\n\n    if (isString_1.default(center)) {\n      centerPoint = center;\n    } else {\n      var _b = center,\n          lng = _b.lng,\n          lat = _b.lat;\n      centerPoint = new BMapGL.Point(lng, lat);\n    }\n\n    if (isCenterChanged && isZoomChanged) {\n      this.map.centerAndZoom(centerPoint, zoom);\n    } else if (isCenterChanged) {\n      this.map.setCenter(centerPoint);\n    } else if (isZoomChanged) {\n      this.map.setZoom(zoom);\n    }\n  };\n\n  Map.prototype.componentWillUnmount = function () {\n    /**\n     * 销毁地图，当使用 WebGL 渲染地图时，如果确认不再使用该地图实例，则需要\n     * 调用本方法销毁 WebGL 上下文，否则频繁创建新地图实例会导致浏览器报：\n     * too many WebGL context 的警告。\n     */\n    if (this.map) {\n      this.map.destroy();\n    }\n  };\n\n  Map.prototype.initialize = function () {\n    if (this.map) {\n      return;\n    } // 创建Map实例，defaultOptions优先级低于指定配置\n\n\n    var options = Object.assign({}, this.props.defaultOptions, this.getOptions());\n\n    if (options.mapType) {\n      options.mapType = options.mapType === 'normal' ? BMAP_NORMAL_MAP : options.mapType;\n      options.mapType = options.mapType === 'earth' ? BMAP_EARTH_MAP : options.mapType;\n    }\n\n    if (this.props.mapStyleV2) {\n      options.style = this.props.mapStyleV2;\n    }\n\n    var map = new BMapGL.Map(this.el.current, options);\n    this.map = map;\n    this.instance = map; // 正常传入经纬度坐标\n\n    if (isString_1.default(this.props.center)) {\n      map.centerAndZoom(this.props.center, this.props.zoom); // 初始化地图,设置中心点坐标和地图级别\n    } else {\n      var _a = this.props.center,\n          lng = _a.lng,\n          lat = _a.lat;\n      var center = new BMapGL.Point(lng, lat);\n      map.centerAndZoom(center, this.props.zoom); // 初始化地图,设置中心点坐标和地图级别\n    }\n\n    if (this.props.heading) {\n      map.setHeading(this.props.heading);\n    }\n\n    if (this.props.tilt) {\n      map.setTilt(this.props.tilt);\n    }\n  };\n\n  Map.prototype.renderChildren = function (children, map) {\n    var _this = this;\n\n    if (!children || !map) return;\n    return react_1.default.Children.map(children, function (child) {\n      if (!child) {\n        return null;\n      }\n\n      if (typeof child.type === 'string' || !child.props) {\n        return child;\n      }\n\n      return react_1.default.cloneElement(child, {\n        map: map\n      }, _this.renderChildren(child.props.children, map));\n    });\n  };\n\n  Map.prototype.render = function () {\n    return react_1.default.createElement(\"div\", {\n      style: this.props.style\n    }, react_1.default.createElement(\"div\", {\n      ref: this.el,\n      className: this.props.className,\n      style: {\n        height: '100%'\n      }\n    }, \"\\u52A0\\u8F7D\\u5730\\u56FE\\u4E2D...\"), react_1.default.createElement(exports.MapContext.Provider, {\n      value: {\n        map: this.map\n      }\n    }, this.renderChildren(this.props.children, this.map)));\n  };\n\n  return Map;\n}(common_1.Component);\n/**\n * defaultProps属性要放在外面，不然生成API文档时，没有默认值\n */\n\n\nMap.defaultProps = {\n  center: {\n    lng: 116.404449,\n    lat: 39.914889\n  },\n  zoom: 12,\n  defaultOptions: {},\n  style: {\n    position: 'relative',\n    height: '350px'\n  }\n};\n/**\n * 地图核心对象，地图控件、覆盖物、图层等需作为其子组件，以获得map的实例化对象\n * @visibleName Map 地图\n */\n\nexports.default = WrapperHOC_1.default(Map, eventsMap, methodsMap); // 顺便给MapApiLoaderHOC在index中加个入口\n\nvar MapApiLoaderHOC_1 = require(\"./MapApiLoaderHOC\");\n\nObject.defineProperty(exports, \"MapApiLoaderHOC\", {\n  enumerable: true,\n  get: function () {\n    return MapApiLoaderHOC_1.default;\n  }\n});","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Map/index.js"],"names":["Object","defineProperty","exports","value","MapContext","tslib_1","require","react_1","__importDefault","common_1","WrapperHOC_1","shallowequal_1","isString_1","eventsMap","methodsMap","enableScrollWheelZoom","enableDragging","enableDoubleClickZoom","enableKeyboard","enableInertialDragging","enableContinuousZoom","enablePinchToZoom","enableRotate","enableTilt","enableAutoResize","default","createContext","map","undefined","Map","_super","__extends","props","_this","call","el","createRef","options","prototype","componentDidMount","initialize","forceUpdate","componentDidUpdate","prevProps","preCenter","center","preZoom","zoom","_a","isCenterChanged","isZoomChanged","centerPoint","_b","lng","lat","BMapGL","Point","centerAndZoom","setCenter","setZoom","componentWillUnmount","destroy","assign","defaultOptions","getOptions","mapType","BMAP_NORMAL_MAP","BMAP_EARTH_MAP","mapStyleV2","style","current","instance","heading","setHeading","tilt","setTilt","renderChildren","children","Children","child","type","cloneElement","render","createElement","ref","className","height","Provider","Component","defaultProps","position","MapApiLoaderHOC_1","enumerable","get"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @file 地图核心组件\n * @author hedongran\n * @email hdr01@126.com\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.MapContext = void 0;\nvar tslib_1 = require(\"tslib\");\nvar react_1 = tslib_1.__importDefault(require(\"react\"));\nvar common_1 = require(\"../common\");\nvar WrapperHOC_1 = tslib_1.__importDefault(require(\"../common/WrapperHOC\"));\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\nvar isString_1 = tslib_1.__importDefault(require(\"../utils/isString\"));\n;\nvar eventsMap = [\n    'click',\n    'dblclick',\n    'rightclick',\n    'rightdblclick',\n    'maptypechange',\n    'mousemove',\n    'mouseover',\n    'mouseout',\n    'movestart',\n    'moving',\n    'moveend',\n    'zoomstart',\n    'zoomend',\n    'addoverlay',\n    'addcontrol',\n    'removecontrol',\n    'removeoverlay',\n    'clearoverlays',\n    'dragstart',\n    'dragging',\n    'dragend',\n    'addtilelayer',\n    'removetilelayer',\n    'load',\n    'resize',\n    'hotspotclick',\n    'hotspotover',\n    'hotspotout',\n    'tilesloaded',\n    'touchstart',\n    'touchmove',\n    'touchend',\n    'longpress'\n];\nvar methodsMap = {\n    enableScrollWheelZoom: ['enableScrollWheelZoom', 'disableScrollWheelZoom'],\n    enableDragging: ['enableDragging', 'disableDragging'],\n    enableDoubleClickZoom: ['enableDoubleClickZoom', 'disableDoubleClickZoom'],\n    enableKeyboard: ['enableKeyboard', 'disableKeyboard'],\n    enableInertialDragging: ['enableInertialDragging', 'disableInertialDragging'],\n    enableContinuousZoom: ['enableContinuousZoom', 'disableContinuousZoom'],\n    enablePinchToZoom: ['enablePinchToZoom', 'disablePinchToZoom'],\n    enableRotate: ['enableRotate', 'disableRotate'],\n    enableTilt: ['enableTilt', 'disableTilt'],\n    enableAutoResize: ['enableAutoResize', 'disableAutoResize']\n};\n;\nexports.MapContext = react_1.default.createContext({\n    // We provide a default function for Context without provider\n    map: undefined\n});\nvar Map = /** @class */ (function (_super) {\n    tslib_1.__extends(Map, _super);\n    function Map(props) {\n        var _this = _super.call(this, props) || this;\n        _this.el = react_1.default.createRef();\n        _this.options = [\n            'minZoom',\n            'maxZoom',\n            'mapType'\n        ];\n        return _this;\n    }\n    Map.prototype.componentDidMount = function () {\n        this.initialize();\n        this.forceUpdate();\n    };\n    Map.prototype.componentDidUpdate = function (prevProps) {\n        var preCenter = prevProps.center, preZoom = prevProps.zoom;\n        var _a = this.props, center = _a.center, zoom = _a.zoom;\n        var isCenterChanged = !!center && !shallowequal_1.default(preCenter, center);\n        var isZoomChanged = !!(zoom && !shallowequal_1.default(preZoom, zoom));\n        var centerPoint;\n        if (isString_1.default(center)) {\n            centerPoint = center;\n        }\n        else {\n            var _b = center, lng = _b.lng, lat = _b.lat;\n            centerPoint = new BMapGL.Point(lng, lat);\n        }\n        if (isCenterChanged && isZoomChanged) {\n            this.map.centerAndZoom(centerPoint, zoom);\n        }\n        else if (isCenterChanged) {\n            this.map.setCenter(centerPoint);\n        }\n        else if (isZoomChanged) {\n            this.map.setZoom(zoom);\n        }\n    };\n    Map.prototype.componentWillUnmount = function () {\n        /**\n         * 销毁地图，当使用 WebGL 渲染地图时，如果确认不再使用该地图实例，则需要\n         * 调用本方法销毁 WebGL 上下文，否则频繁创建新地图实例会导致浏览器报：\n         * too many WebGL context 的警告。\n         */\n        if (this.map) {\n            this.map.destroy();\n        }\n    };\n    Map.prototype.initialize = function () {\n        if (this.map) {\n            return;\n        }\n        // 创建Map实例，defaultOptions优先级低于指定配置\n        var options = Object.assign({}, this.props.defaultOptions, this.getOptions());\n        if (options.mapType) {\n            options.mapType = (options.mapType === 'normal' ? BMAP_NORMAL_MAP : options.mapType);\n            options.mapType = (options.mapType === 'earth' ? BMAP_EARTH_MAP : options.mapType);\n        }\n        if (this.props.mapStyleV2) {\n            options.style = this.props.mapStyleV2;\n        }\n        var map = new BMapGL.Map(this.el.current, options);\n        this.map = map;\n        this.instance = map;\n        // 正常传入经纬度坐标\n        if (isString_1.default(this.props.center)) {\n            map.centerAndZoom(this.props.center, this.props.zoom); // 初始化地图,设置中心点坐标和地图级别\n        }\n        else {\n            var _a = this.props.center, lng = _a.lng, lat = _a.lat;\n            var center = new BMapGL.Point(lng, lat);\n            map.centerAndZoom(center, this.props.zoom); // 初始化地图,设置中心点坐标和地图级别\n        }\n        if (this.props.heading) {\n            map.setHeading(this.props.heading);\n        }\n        if (this.props.tilt) {\n            map.setTilt(this.props.tilt);\n        }\n    };\n    Map.prototype.renderChildren = function (children, map) {\n        var _this = this;\n        if (!children || !map)\n            return;\n        return react_1.default.Children.map(children, function (child) {\n            if (!child) {\n                return null;\n            }\n            if (typeof child.type === 'string' || !child.props) {\n                return child;\n            }\n            return react_1.default.cloneElement(child, { map: map }, _this.renderChildren(child.props.children, map));\n        });\n    };\n    Map.prototype.render = function () {\n        return (react_1.default.createElement(\"div\", { style: this.props.style },\n            react_1.default.createElement(\"div\", { ref: this.el, className: this.props.className, style: { height: '100%' } }, \"\\u52A0\\u8F7D\\u5730\\u56FE\\u4E2D...\"),\n            react_1.default.createElement(exports.MapContext.Provider, { value: {\n                    map: this.map\n                } }, this.renderChildren(this.props.children, this.map))));\n    };\n    return Map;\n}(common_1.Component));\n/**\n * defaultProps属性要放在外面，不然生成API文档时，没有默认值\n */\nMap.defaultProps = {\n    center: { lng: 116.404449, lat: 39.914889 },\n    zoom: 12,\n    defaultOptions: {},\n    style: {\n        position: 'relative',\n        height: '350px'\n    }\n};\n/**\n * 地图核心对象，地图控件、覆盖物、图层等需作为其子组件，以获得map的实例化对象\n * @visibleName Map 地图\n */\nexports.default = WrapperHOC_1.default(Map, eventsMap, methodsMap);\n// 顺便给MapApiLoaderHOC在index中加个入口\nvar MapApiLoaderHOC_1 = require(\"./MapApiLoaderHOC\");\nObject.defineProperty(exports, \"MapApiLoaderHOC\", { enumerable: true, get: function () { return MapApiLoaderHOC_1.default; } });\n"]},"metadata":{},"sourceType":"script"}