{"ast":null,"code":"\"use strict\";\n/**\n * @file 自定义覆盖物的DOM生成类\n * @author hedongran\n * @email hdr01@126.com\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar react_dom_1 = require(\"react-dom\");\n/**\n * 自定义覆盖物的DOM生成类\n * @param point 定位点坐标\n * @param options 传入参数，如offset等\n */\n\n\nfunction CustomOverlayDom(point, options) {\n  this._point = new BMapGL.Point(point.lng, point.lat);\n  this._options = options || {};\n  this._html = options.html || ''; // 这里不用 CustomOverlayDom.prototype = new BMapGL.Overlay() 继承原型链上的方法\n  // 因为在异步加载的场景下，上面的语句调用了BMapGL会导致`BMapGL not defined`的报错\n  // 所以这里用一个魔改的trick方法来继承 BMapGL.Overlay 原型链上的方法\n  // 注意，这样写需要在if判断中剔除要覆盖的函数\n\n  var extend = new BMapGL.Overlay();\n\n  for (var key in extend) {\n    if (key !== 'initialize' && key !== 'draw' && key !== 'destroy') {\n      this.__proto__[key] = extend[key];\n    }\n  }\n}\n\nCustomOverlayDom.prototype.initialize = function (map) {\n  this._map = map;\n  this._div = document.createElement(\"div\");\n  this._div.style.position = \"absolute\";\n  this._div.style.zIndex = BMapGL.Overlay.getZIndex(this._options.zIndex || this._point.lat);\n  react_dom_1.render(this._html, this._div);\n\n  this._div.onmousedown = function (event) {\n    event = event || window.event;\n\n    if (event.preventDefault) {\n      event.preventDefault();\n    } else {\n      event.returnValue = false;\n    }\n\n    return false;\n  };\n\n  map.getPanes().floatShadow.appendChild(this._div);\n  return this._div;\n};\n\nCustomOverlayDom.prototype.destroy = function () {\n  react_dom_1.unmountComponentAtNode(this._div);\n};\n\nCustomOverlayDom.prototype.draw = function () {\n  var map = this._map;\n  var pixel = map.pointToOverlayPixel(this._point);\n  var offset = {\n    width: 0,\n    height: 0\n  };\n\n  if (this._options && this._options.offset) {\n    offset = this._options.offset;\n  }\n\n  var offW = offset.width;\n  var offH = offset.height;\n\n  if (this._options && this._options.unit && this._options.unit === 'm') {\n    offW /= map.getZoomUnits();\n    offH /= map.getZoomUnits();\n  }\n\n  this._div.style.left = pixel.x + offW + 'px';\n  this._div.style.top = pixel.y + offH + 'px';\n  this._div.style.transform = 'translate(-50%, -100%)';\n};\n\nexports.default = CustomOverlayDom;","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Overlay/CustomOverlayDom.js"],"names":["Object","defineProperty","exports","value","react_dom_1","require","CustomOverlayDom","point","options","_point","BMapGL","Point","lng","lat","_options","_html","html","extend","Overlay","key","__proto__","prototype","initialize","map","_map","_div","document","createElement","style","position","zIndex","getZIndex","render","onmousedown","event","window","preventDefault","returnValue","getPanes","floatShadow","appendChild","destroy","unmountComponentAtNode","draw","pixel","pointToOverlayPixel","offset","width","height","offW","offH","unit","getZoomUnits","left","x","top","y","transform","default"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @file 自定义覆盖物的DOM生成类\n * @author hedongran\n * @email hdr01@126.com\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar react_dom_1 = require(\"react-dom\");\n/**\n * 自定义覆盖物的DOM生成类\n * @param point 定位点坐标\n * @param options 传入参数，如offset等\n */\nfunction CustomOverlayDom(point, options) {\n    this._point = new BMapGL.Point(point.lng, point.lat);\n    this._options = options || {};\n    this._html = options.html || '';\n    // 这里不用 CustomOverlayDom.prototype = new BMapGL.Overlay() 继承原型链上的方法\n    // 因为在异步加载的场景下，上面的语句调用了BMapGL会导致`BMapGL not defined`的报错\n    // 所以这里用一个魔改的trick方法来继承 BMapGL.Overlay 原型链上的方法\n    // 注意，这样写需要在if判断中剔除要覆盖的函数\n    var extend = new BMapGL.Overlay();\n    for (var key in extend) {\n        if (key !== 'initialize' && key !== 'draw' && key !== 'destroy') {\n            this.__proto__[key] = extend[key];\n        }\n    }\n}\nCustomOverlayDom.prototype.initialize = function (map) {\n    this._map = map;\n    this._div = document.createElement(\"div\");\n    this._div.style.position = \"absolute\";\n    this._div.style.zIndex = BMapGL.Overlay.getZIndex(this._options.zIndex || this._point.lat);\n    react_dom_1.render(this._html, this._div);\n    this._div.onmousedown = function (event) {\n        event = event || window.event;\n        if (event.preventDefault) {\n            event.preventDefault();\n        }\n        else {\n            event.returnValue = false;\n        }\n        return false;\n    };\n    map.getPanes().floatShadow.appendChild(this._div);\n    return this._div;\n};\nCustomOverlayDom.prototype.destroy = function () {\n    react_dom_1.unmountComponentAtNode(this._div);\n};\nCustomOverlayDom.prototype.draw = function () {\n    var map = this._map;\n    var pixel = map.pointToOverlayPixel(this._point);\n    var offset = { width: 0, height: 0 };\n    if (this._options && this._options.offset) {\n        offset = this._options.offset;\n    }\n    var offW = offset.width;\n    var offH = offset.height;\n    if (this._options && this._options.unit && this._options.unit === 'm') {\n        offW /= map.getZoomUnits();\n        offH /= map.getZoomUnits();\n    }\n    this._div.style.left = pixel.x + offW + 'px';\n    this._div.style.top = pixel.y + offH + 'px';\n    this._div.style.transform = 'translate(-50%, -100%)';\n};\nexports.default = CustomOverlayDom;\n"]},"metadata":{},"sourceType":"script"}