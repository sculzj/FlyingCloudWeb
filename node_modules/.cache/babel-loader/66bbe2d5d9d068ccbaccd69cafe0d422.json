{"ast":null,"code":"\"use strict\";\n/**\n * @file 地图标注组件\n * @author hedongran\n * @email hdr01@126.com\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar common_1 = require(\"../common\");\n\nvar WrapperHOC_1 = tslib_1.__importDefault(require(\"../common/WrapperHOC\"));\n\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\n\nvar Map_1 = require(\"../Map\");\n\nfunction defaultIcons() {\n  var defaultIconUrl = '//mapopen.bj.bcebos.com/cms/react-bmap/markers_new2x_fbb9e99.png';\n  var icons = {\n    'simple_red': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n      imageOffset: new BMapGL.Size(454 / 2, 378 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'simple_blue': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n      imageOffset: new BMapGL.Size(454 / 2, 450 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'loc_red': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(46 / 2, 70 / 2), {\n      imageOffset: new BMapGL.Size(400 / 2, 378 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'loc_blue': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(46 / 2, 70 / 2), {\n      imageOffset: new BMapGL.Size(400 / 2, 450 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'start': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(50 / 2, 80 / 2), {\n      imageOffset: new BMapGL.Size(400 / 2, 278 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'end': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(50 / 2, 80 / 2), {\n      imageOffset: new BMapGL.Size(450 / 2, 278 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    }),\n    'location': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(28 / 2, 40 / 2), {\n      imageOffset: new BMapGL.Size(248 / 2, 466 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    })\n  };\n\n  for (var i = 1; i <= 10; i++) {\n    icons['red' + i] = new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n      imageOffset: new BMapGL.Size(42 / 2 * (i - 1), 0),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    });\n  }\n\n  for (var i = 1; i <= 10; i++) {\n    icons['blue' + i] = new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n      imageOffset: new BMapGL.Size(42 / 2 * (i - 1), 132 / 2),\n      imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n    });\n  }\n\n  return icons;\n}\n\n;\nvar eventsMap = ['click', 'dblclick', 'mousedown', 'mouseup', 'mouseout', 'mouseover', 'remove', 'infowindowclose', 'infowindowopen', 'dragstart', 'dragging', 'dragend', 'rightclick'];\nvar methodsMap = {\n  enableMassClear: ['enableMassClear', 'disableMassClear'],\n  enableDragging: ['enableDragging', 'disableDragging']\n};\n\nvar Marker =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(Marker, _super);\n\n  function Marker(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.options = ['offset', 'icon', 'enableMassClear', 'enableDragging', 'enableClicking', 'raiseOnDrag', 'draggingCursor', 'rotation', 'title'];\n    _this.defaultIcons = defaultIcons();\n    return _this;\n  }\n\n  Marker.prototype.componentDidUpdate = function (prevProps) {\n    if (!this.map) {\n      this.initialize();\n      return;\n    }\n\n    var _a = this.props,\n        position = _a.position,\n        icon = _a.icon,\n        autoViewport = _a.autoViewport,\n        offset = _a.offset,\n        isTop = _a.isTop;\n    var prePosition = prevProps.position,\n        preIcon = prevProps.icon,\n        preViewport = prevProps.autoViewport,\n        preOffset = prevProps.offset,\n        preTop = prevProps.isTop;\n    var isDataChanged = position && !shallowequal_1.default(position, prePosition);\n    var isIconChanged = !!(icon && !shallowequal_1.default(icon, preIcon));\n    var isViewportChanged = !shallowequal_1.default(autoViewport, preViewport);\n    var isOffsetChanged = !!(offset && !shallowequal_1.default(offset, preOffset));\n    var isTopChanged = !shallowequal_1.default(isTop, preTop);\n    var point = this.parsePosition(position);\n\n    if (isDataChanged) {\n      this.marker.setPosition(point);\n    }\n\n    if (isIconChanged) {\n      var renderIcon = this.parseIcon(icon);\n      this.marker.setIcon(renderIcon);\n    }\n\n    if (isOffsetChanged) {\n      this.marker.setOffset(offset);\n    }\n\n    if (isTopChanged) {\n      this.marker.setTop(!!isTop);\n    }\n\n    if (autoViewport && (isDataChanged || isViewportChanged)) {\n      this.map.setCenter(point);\n    }\n  };\n\n  Marker.prototype.componentDidMount = function () {\n    this.initialize();\n  };\n\n  Marker.prototype.componentWillUnmount = function () {\n    this.destroy();\n  };\n\n  Marker.prototype.destroy = function () {\n    if (this.marker && this.map) {\n      this.map.removeOverlay(this.marker); // @ts-ignore\n\n      this.instance = this.marker = undefined;\n    }\n  };\n\n  Marker.prototype.initialize = function () {\n    var map = this.map = this.getMap();\n\n    if (!map) {\n      return;\n    }\n\n    this.destroy();\n    var icon = this.parseIcon(this.props.icon);\n    var position = this.parsePosition(this.props.position);\n    var options = this.getOptions();\n    options.icon = icon;\n    this.instance = this.marker = new BMapGL.Marker(position, options);\n\n    if (this.props.isTop) {\n      this.marker.setTop(true);\n    }\n\n    map.addOverlay(this.marker);\n\n    if (this.props.autoViewport) {\n      map.setCenter(position);\n    }\n  };\n\n  Marker.prototype.parsePosition = function (position) {\n    var isMC = this.props.coordType === 'bd09mc';\n    var point;\n\n    if (position instanceof Array) {\n      point = new BMapGL.Point(position[0], position[1]);\n    } else if (position instanceof BMapGL.Point) {\n      point = position;\n    } else {\n      point = new BMapGL.Point(position.lng, position.lat);\n    }\n\n    if (isMC) {\n      point = BMapGL.Projection.convertMC2LL(point);\n    }\n\n    return point;\n  };\n\n  Marker.prototype.parseIcon = function (icon) {\n    var renderIcon;\n\n    if (icon && icon instanceof BMapGL.Icon) {\n      renderIcon = icon;\n    } else {\n      if (icon && this.defaultIcons[icon]) {\n        renderIcon = this.defaultIcons[icon];\n      } else {\n        renderIcon = this.defaultIcons.simple_red;\n      }\n    }\n\n    return renderIcon;\n  };\n\n  Marker.prototype.render = function () {\n    return null;\n  };\n\n  Marker.contextType = Map_1.MapContext;\n  return Marker;\n}(common_1.Component);\n/**\n * defaultProps属性要放在外面，不然生成API文档时，没有默认值\n */\n\n\nMarker.defaultProps = {\n  icon: 'simple_red'\n};\n/**\n * 在地图上绘制简单的标注点\n * @visibleName Marker 点标注\n */\n\nexports.default = WrapperHOC_1.default(Marker, eventsMap, methodsMap);","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Overlay/Marker.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","common_1","WrapperHOC_1","__importDefault","shallowequal_1","Map_1","defaultIcons","defaultIconUrl","icons","BMapGL","Icon","Size","imageOffset","imageSize","i","eventsMap","methodsMap","enableMassClear","enableDragging","Marker","_super","__extends","props","_this","call","options","prototype","componentDidUpdate","prevProps","map","initialize","_a","position","icon","autoViewport","offset","isTop","prePosition","preIcon","preViewport","preOffset","preTop","isDataChanged","default","isIconChanged","isViewportChanged","isOffsetChanged","isTopChanged","point","parsePosition","marker","setPosition","renderIcon","parseIcon","setIcon","setOffset","setTop","setCenter","componentDidMount","componentWillUnmount","destroy","removeOverlay","instance","undefined","getMap","getOptions","addOverlay","isMC","coordType","Array","Point","lng","lat","Projection","convertMC2LL","simple_red","render","contextType","MapContext","Component","defaultProps"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @file 地图标注组件\n * @author hedongran\n * @email hdr01@126.com\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar common_1 = require(\"../common\");\nvar WrapperHOC_1 = tslib_1.__importDefault(require(\"../common/WrapperHOC\"));\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\nvar Map_1 = require(\"../Map\");\nfunction defaultIcons() {\n    var defaultIconUrl = '//mapopen.bj.bcebos.com/cms/react-bmap/markers_new2x_fbb9e99.png';\n    var icons = {\n        'simple_red': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n            imageOffset: new BMapGL.Size(454 / 2, 378 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'simple_blue': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n            imageOffset: new BMapGL.Size(454 / 2, 450 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'loc_red': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(46 / 2, 70 / 2), {\n            imageOffset: new BMapGL.Size(400 / 2, 378 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'loc_blue': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(46 / 2, 70 / 2), {\n            imageOffset: new BMapGL.Size(400 / 2, 450 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'start': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(50 / 2, 80 / 2), {\n            imageOffset: new BMapGL.Size(400 / 2, 278 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'end': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(50 / 2, 80 / 2), {\n            imageOffset: new BMapGL.Size(450 / 2, 278 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n        'location': new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(28 / 2, 40 / 2), {\n            imageOffset: new BMapGL.Size(248 / 2, 466 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        }),\n    };\n    for (var i = 1; i <= 10; i++) {\n        icons['red' + i] = new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n            imageOffset: new BMapGL.Size(42 / 2 * (i - 1), 0),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        });\n    }\n    for (var i = 1; i <= 10; i++) {\n        icons['blue' + i] = new BMapGL.Icon(defaultIconUrl, new BMapGL.Size(42 / 2, 66 / 2), {\n            imageOffset: new BMapGL.Size(42 / 2 * (i - 1), 132 / 2),\n            imageSize: new BMapGL.Size(600 / 2, 600 / 2)\n        });\n    }\n    return icons;\n}\n;\nvar eventsMap = [\n    'click',\n    'dblclick',\n    'mousedown',\n    'mouseup',\n    'mouseout',\n    'mouseover',\n    'remove',\n    'infowindowclose',\n    'infowindowopen',\n    'dragstart',\n    'dragging',\n    'dragend',\n    'rightclick'\n];\nvar methodsMap = {\n    enableMassClear: ['enableMassClear', 'disableMassClear'],\n    enableDragging: ['enableDragging', 'disableDragging']\n};\nvar Marker = /** @class */ (function (_super) {\n    tslib_1.__extends(Marker, _super);\n    function Marker(props) {\n        var _this = _super.call(this, props) || this;\n        _this.options = [\n            'offset',\n            'icon',\n            'enableMassClear',\n            'enableDragging',\n            'enableClicking',\n            'raiseOnDrag',\n            'draggingCursor',\n            'rotation',\n            'title'\n        ];\n        _this.defaultIcons = defaultIcons();\n        return _this;\n    }\n    Marker.prototype.componentDidUpdate = function (prevProps) {\n        if (!this.map) {\n            this.initialize();\n            return;\n        }\n        var _a = this.props, position = _a.position, icon = _a.icon, autoViewport = _a.autoViewport, offset = _a.offset, isTop = _a.isTop;\n        var prePosition = prevProps.position, preIcon = prevProps.icon, preViewport = prevProps.autoViewport, preOffset = prevProps.offset, preTop = prevProps.isTop;\n        var isDataChanged = position && !shallowequal_1.default(position, prePosition);\n        var isIconChanged = !!(icon && !shallowequal_1.default(icon, preIcon));\n        var isViewportChanged = !shallowequal_1.default(autoViewport, preViewport);\n        var isOffsetChanged = !!(offset && !shallowequal_1.default(offset, preOffset));\n        var isTopChanged = !shallowequal_1.default(isTop, preTop);\n        var point = this.parsePosition(position);\n        if (isDataChanged) {\n            this.marker.setPosition(point);\n        }\n        if (isIconChanged) {\n            var renderIcon = this.parseIcon(icon);\n            this.marker.setIcon(renderIcon);\n        }\n        if (isOffsetChanged) {\n            this.marker.setOffset(offset);\n        }\n        if (isTopChanged) {\n            this.marker.setTop(!!isTop);\n        }\n        if (autoViewport && (isDataChanged || isViewportChanged)) {\n            this.map.setCenter(point);\n        }\n    };\n    Marker.prototype.componentDidMount = function () {\n        this.initialize();\n    };\n    Marker.prototype.componentWillUnmount = function () {\n        this.destroy();\n    };\n    Marker.prototype.destroy = function () {\n        if (this.marker && this.map) {\n            this.map.removeOverlay(this.marker);\n            // @ts-ignore\n            this.instance = this.marker = undefined;\n        }\n    };\n    Marker.prototype.initialize = function () {\n        var map = this.map = this.getMap();\n        if (!map) {\n            return;\n        }\n        this.destroy();\n        var icon = this.parseIcon(this.props.icon);\n        var position = this.parsePosition(this.props.position);\n        var options = this.getOptions();\n        options.icon = icon;\n        this.instance = this.marker = new BMapGL.Marker(position, options);\n        if (this.props.isTop) {\n            this.marker.setTop(true);\n        }\n        map.addOverlay(this.marker);\n        if (this.props.autoViewport) {\n            map.setCenter(position);\n        }\n    };\n    Marker.prototype.parsePosition = function (position) {\n        var isMC = this.props.coordType === 'bd09mc';\n        var point;\n        if (position instanceof Array) {\n            point = new BMapGL.Point(position[0], position[1]);\n        }\n        else if (position instanceof BMapGL.Point) {\n            point = position;\n        }\n        else {\n            point = new BMapGL.Point(position.lng, position.lat);\n        }\n        if (isMC) {\n            point = BMapGL.Projection.convertMC2LL(point);\n        }\n        return point;\n    };\n    Marker.prototype.parseIcon = function (icon) {\n        var renderIcon;\n        if (icon && icon instanceof BMapGL.Icon) {\n            renderIcon = icon;\n        }\n        else {\n            if (icon && this.defaultIcons[icon]) {\n                renderIcon = this.defaultIcons[icon];\n            }\n            else {\n                renderIcon = this.defaultIcons.simple_red;\n            }\n        }\n        return renderIcon;\n    };\n    Marker.prototype.render = function () {\n        return null;\n    };\n    Marker.contextType = Map_1.MapContext;\n    return Marker;\n}(common_1.Component));\n/**\n * defaultProps属性要放在外面，不然生成API文档时，没有默认值\n */\nMarker.defaultProps = {\n    icon: 'simple_red'\n};\n/**\n * 在地图上绘制简单的标注点\n * @visibleName Marker 点标注\n */\nexports.default = WrapperHOC_1.default(Marker, eventsMap, methodsMap);\n"]},"metadata":{},"sourceType":"script"}