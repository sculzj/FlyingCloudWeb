{"ast":null,"code":"\"use strict\";\n/**\n * @file mapvgl可视化图层\n * @author hedongran\n * @email hdr01@126.com\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\"); // @ts-ignore\n\n\nvar mapvgl = tslib_1.__importStar(require(\"mapvgl\")); // @ts-ignore\n\n\nvar mapvglThree = tslib_1.__importStar(require(\"mapvgl/dist/mapvgl.threelayers.min\"));\n\nvar common_1 = require(\"../common\");\n\nvar MapvglView_1 = require(\"./MapvglView\");\n\n;\n/**\n * 该组件将MapVGL的图层使用`react`进行了一层封装。具体关于MapVGL有哪些图层，以及图层的属性，请查阅[MapVGL文档](https://mapv.baidu.com/gl/docs/)\n * @visibleName MapvglLayer MapVGL图层\n */\n\nvar MapvglLayer =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(MapvglLayer, _super);\n\n  function MapvglLayer(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._createLayer = false;\n    var self = _this;\n\n    if (_this.props.getMethods) {\n      _this.props.getMethods({\n        setViewport: _this.setViewport.bind(self)\n      });\n    }\n\n    return _this;\n  }\n\n  MapvglLayer.prototype.componentDidMount = function () {\n    this.initialize();\n  };\n\n  MapvglLayer.prototype.componentWillUnmount = function () {\n    this.destroy();\n  };\n\n  MapvglLayer.prototype.componentDidUpdate = function (prevProps) {\n    var _a = this.props,\n        type = _a.type,\n        data = _a.data,\n        options = _a.options,\n        autoViewport = _a.autoViewport;\n    var preType = prevProps.type,\n        preData = prevProps.data,\n        preOptions = prevProps.options,\n        preViewport = prevProps.autoViewport;\n\n    if (!this.map || !this.layer) {\n      this.initialize();\n      return;\n    }\n\n    if (type !== preType) {\n      this.destroy();\n      this.initialize();\n      return;\n    }\n\n    if (JSON.stringify(preOptions) !== JSON.stringify(options)) {\n      this.layer.setOptions(options);\n    }\n\n    if (JSON.stringify(preData) !== JSON.stringify(data)) {\n      this.layer.setData(data);\n    }\n\n    if (autoViewport && (JSON.stringify(preData) !== JSON.stringify(data) || autoViewport !== preViewport)) {\n      this.setViewport();\n    }\n  };\n\n  MapvglLayer.prototype.destroy = function () {\n    if (this.layer && this.view) {\n      this._createLayer = false;\n      this.view.removeLayer(this.layer);\n      this.layer.destroy(); // @ts-ignore\n\n      this.layer = null;\n    }\n  };\n\n  MapvglLayer.prototype.initialize = function () {\n    var map = this.map = this.getMap();\n    var view = this.view = this.props.view || this.context.view;\n\n    if (!map || !view) {\n      return;\n    }\n\n    if (!this._createLayer) {\n      this.createLayers();\n    }\n\n    this.layer.setData(this.props.data);\n\n    if (this.props.autoViewport) {\n      this.setViewport();\n    }\n  };\n\n  MapvglLayer.prototype.setViewport = function () {\n    var isMC = this.props.coordType === 'bd09mc';\n\n    var getPoint = function (coordinate) {\n      var p = new BMapGL.Point(coordinate[0], coordinate[1]);\n      return isMC ? BMapGL.Projection.convertMC2LL(p) : p;\n    };\n\n    var points = [];\n    this.props.data.forEach(function (data) {\n      if (data.geometry.type === 'Point') {\n        points.push(getPoint(data.geometry.coordinates));\n      } else if (data.geometry.type === 'LineString') {\n        data.geometry.coordinates.forEach(function (item) {\n          points.push(getPoint(item));\n        });\n      } else if (data.geometry.type === 'Polygon') {\n        data.geometry.coordinates[0].forEach(function (item) {\n          points.push(getPoint(item));\n        });\n      } else if (data.geometry.type === 'MultiPolygon') {\n        data.geometry.coordinates.forEach(function (polygon) {\n          polygon[0].forEach(function (item) {\n            points.push(getPoint(item));\n          });\n        });\n      }\n    });\n\n    if (points.length > 0) {\n      this.map.setViewport(points, this.props.viewportOptions || {});\n    }\n  };\n\n  MapvglLayer.prototype.createLayers = function () {\n    if (mapvgl[this.props.type] || mapvglThree[this.props.type]) {\n      this._createLayer = true;\n      var Constructor = mapvgl[this.props.type] ? mapvgl : mapvglThree;\n      this.layer = new Constructor[this.props.type](this.props.options);\n      this.view.addLayer(this.layer);\n    } else {\n      console.error(\"mapvgl doesn't have layer \" + this.props.type + \"!\");\n    }\n  };\n\n  MapvglLayer.prototype.render = function () {\n    return null;\n  };\n\n  MapvglLayer.contextType = MapvglView_1.ViewContext;\n  return MapvglLayer;\n}(common_1.Component);\n\nexports.default = MapvglLayer;","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Layer/MapvglLayer.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","mapvgl","__importStar","mapvglThree","common_1","MapvglView_1","MapvglLayer","_super","__extends","props","_this","call","_createLayer","self","getMethods","setViewport","bind","prototype","componentDidMount","initialize","componentWillUnmount","destroy","componentDidUpdate","prevProps","_a","type","data","options","autoViewport","preType","preData","preOptions","preViewport","map","layer","JSON","stringify","setOptions","setData","view","removeLayer","getMap","context","createLayers","isMC","coordType","getPoint","coordinate","p","BMapGL","Point","Projection","convertMC2LL","points","forEach","geometry","push","coordinates","item","polygon","length","viewportOptions","Constructor","addLayer","console","error","render","contextType","ViewContext","Component","default"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,OAAO,GAAGC,OAAO,CAAC,OAAD,CAArB,C,CACA;;;AACA,IAAIC,MAAM,GAAGF,OAAO,CAACG,YAAR,CAAqBF,OAAO,CAAC,QAAD,CAA5B,CAAb,C,CACA;;;AACA,IAAIG,WAAW,GAAGJ,OAAO,CAACG,YAAR,CAAqBF,OAAO,CAAC,oCAAD,CAA5B,CAAlB;;AACA,IAAII,QAAQ,GAAGJ,OAAO,CAAC,WAAD,CAAtB;;AACA,IAAIK,YAAY,GAAGL,OAAO,CAAC,cAAD,CAA1B;;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIM,WAAW;AAAG;AAAe,UAAUC,MAAV,EAAkB;AAC/CR,EAAAA,OAAO,CAACS,SAAR,CAAkBF,WAAlB,EAA+BC,MAA/B;;AACA,WAASD,WAAT,CAAqBG,KAArB,EAA4B;AACxB,QAAIC,KAAK,GAAGH,MAAM,CAACI,IAAP,CAAY,IAAZ,EAAkBF,KAAlB,KAA4B,IAAxC;;AACAC,IAAAA,KAAK,CAACE,YAAN,GAAqB,KAArB;AACA,QAAIC,IAAI,GAAGH,KAAX;;AACA,QAAIA,KAAK,CAACD,KAAN,CAAYK,UAAhB,EAA4B;AACxBJ,MAAAA,KAAK,CAACD,KAAN,CAAYK,UAAZ,CAAuB;AACnBC,QAAAA,WAAW,EAAEL,KAAK,CAACK,WAAN,CAAkBC,IAAlB,CAAuBH,IAAvB;AADM,OAAvB;AAGH;;AACD,WAAOH,KAAP;AACH;;AACDJ,EAAAA,WAAW,CAACW,SAAZ,CAAsBC,iBAAtB,GAA0C,YAAY;AAClD,SAAKC,UAAL;AACH,GAFD;;AAGAb,EAAAA,WAAW,CAACW,SAAZ,CAAsBG,oBAAtB,GAA6C,YAAY;AACrD,SAAKC,OAAL;AACH,GAFD;;AAGAf,EAAAA,WAAW,CAACW,SAAZ,CAAsBK,kBAAtB,GAA2C,UAAUC,SAAV,EAAqB;AAC5D,QAAIC,EAAE,GAAG,KAAKf,KAAd;AAAA,QAAqBgB,IAAI,GAAGD,EAAE,CAACC,IAA/B;AAAA,QAAqCC,IAAI,GAAGF,EAAE,CAACE,IAA/C;AAAA,QAAqDC,OAAO,GAAGH,EAAE,CAACG,OAAlE;AAAA,QAA2EC,YAAY,GAAGJ,EAAE,CAACI,YAA7F;AACA,QAAIC,OAAO,GAAGN,SAAS,CAACE,IAAxB;AAAA,QAA8BK,OAAO,GAAGP,SAAS,CAACG,IAAlD;AAAA,QAAwDK,UAAU,GAAGR,SAAS,CAACI,OAA/E;AAAA,QAAwFK,WAAW,GAAGT,SAAS,CAACK,YAAhH;;AACA,QAAI,CAAC,KAAKK,GAAN,IAAa,CAAC,KAAKC,KAAvB,EAA8B;AAC1B,WAAKf,UAAL;AACA;AACH;;AACD,QAAIM,IAAI,KAAKI,OAAb,EAAsB;AAClB,WAAKR,OAAL;AACA,WAAKF,UAAL;AACA;AACH;;AACD,QAAIgB,IAAI,CAACC,SAAL,CAAeL,UAAf,MAA+BI,IAAI,CAACC,SAAL,CAAeT,OAAf,CAAnC,EAA4D;AACxD,WAAKO,KAAL,CAAWG,UAAX,CAAsBV,OAAtB;AACH;;AACD,QAAIQ,IAAI,CAACC,SAAL,CAAeN,OAAf,MAA4BK,IAAI,CAACC,SAAL,CAAeV,IAAf,CAAhC,EAAsD;AAClD,WAAKQ,KAAL,CAAWI,OAAX,CAAmBZ,IAAnB;AACH;;AACD,QAAIE,YAAY,KAAKO,IAAI,CAACC,SAAL,CAAeN,OAAf,MAA4BK,IAAI,CAACC,SAAL,CAAeV,IAAf,CAA5B,IAAoDE,YAAY,KAAKI,WAA1E,CAAhB,EAAwG;AACpG,WAAKjB,WAAL;AACH;AACJ,GArBD;;AAsBAT,EAAAA,WAAW,CAACW,SAAZ,CAAsBI,OAAtB,GAAgC,YAAY;AACxC,QAAI,KAAKa,KAAL,IAAc,KAAKK,IAAvB,EAA6B;AACzB,WAAK3B,YAAL,GAAoB,KAApB;AACA,WAAK2B,IAAL,CAAUC,WAAV,CAAsB,KAAKN,KAA3B;AACA,WAAKA,KAAL,CAAWb,OAAX,GAHyB,CAIzB;;AACA,WAAKa,KAAL,GAAa,IAAb;AACH;AACJ,GARD;;AASA5B,EAAAA,WAAW,CAACW,SAAZ,CAAsBE,UAAtB,GAAmC,YAAY;AAC3C,QAAIc,GAAG,GAAG,KAAKA,GAAL,GAAW,KAAKQ,MAAL,EAArB;AACA,QAAIF,IAAI,GAAG,KAAKA,IAAL,GAAY,KAAK9B,KAAL,CAAW8B,IAAX,IAAmB,KAAKG,OAAL,CAAaH,IAAvD;;AACA,QAAI,CAACN,GAAD,IAAQ,CAACM,IAAb,EAAmB;AACf;AACH;;AACD,QAAI,CAAC,KAAK3B,YAAV,EAAwB;AACpB,WAAK+B,YAAL;AACH;;AACD,SAAKT,KAAL,CAAWI,OAAX,CAAmB,KAAK7B,KAAL,CAAWiB,IAA9B;;AACA,QAAI,KAAKjB,KAAL,CAAWmB,YAAf,EAA6B;AACzB,WAAKb,WAAL;AACH;AACJ,GAbD;;AAcAT,EAAAA,WAAW,CAACW,SAAZ,CAAsBF,WAAtB,GAAoC,YAAY;AAC5C,QAAI6B,IAAI,GAAG,KAAKnC,KAAL,CAAWoC,SAAX,KAAyB,QAApC;;AACA,QAAIC,QAAQ,GAAG,UAAUC,UAAV,EAAsB;AACjC,UAAIC,CAAC,GAAG,IAAIC,MAAM,CAACC,KAAX,CAAiBH,UAAU,CAAC,CAAD,CAA3B,EAAgCA,UAAU,CAAC,CAAD,CAA1C,CAAR;AACA,aAAOH,IAAI,GAAGK,MAAM,CAACE,UAAP,CAAkBC,YAAlB,CAA+BJ,CAA/B,CAAH,GAAuCA,CAAlD;AACH,KAHD;;AAIA,QAAIK,MAAM,GAAG,EAAb;AACA,SAAK5C,KAAL,CAAWiB,IAAX,CAAgB4B,OAAhB,CAAwB,UAAU5B,IAAV,EAAgB;AACpC,UAAIA,IAAI,CAAC6B,QAAL,CAAc9B,IAAd,KAAuB,OAA3B,EAAoC;AAChC4B,QAAAA,MAAM,CAACG,IAAP,CAAYV,QAAQ,CAACpB,IAAI,CAAC6B,QAAL,CAAcE,WAAf,CAApB;AACH,OAFD,MAGK,IAAI/B,IAAI,CAAC6B,QAAL,CAAc9B,IAAd,KAAuB,YAA3B,EAAyC;AAC1CC,QAAAA,IAAI,CAAC6B,QAAL,CAAcE,WAAd,CAA0BH,OAA1B,CAAkC,UAAUI,IAAV,EAAgB;AAC9CL,UAAAA,MAAM,CAACG,IAAP,CAAYV,QAAQ,CAACY,IAAD,CAApB;AACH,SAFD;AAGH,OAJI,MAKA,IAAIhC,IAAI,CAAC6B,QAAL,CAAc9B,IAAd,KAAuB,SAA3B,EAAsC;AACvCC,QAAAA,IAAI,CAAC6B,QAAL,CAAcE,WAAd,CAA0B,CAA1B,EAA6BH,OAA7B,CAAqC,UAAUI,IAAV,EAAgB;AACjDL,UAAAA,MAAM,CAACG,IAAP,CAAYV,QAAQ,CAACY,IAAD,CAApB;AACH,SAFD;AAGH,OAJI,MAKA,IAAIhC,IAAI,CAAC6B,QAAL,CAAc9B,IAAd,KAAuB,cAA3B,EAA2C;AAC5CC,QAAAA,IAAI,CAAC6B,QAAL,CAAcE,WAAd,CAA0BH,OAA1B,CAAkC,UAAUK,OAAV,EAAmB;AACjDA,UAAAA,OAAO,CAAC,CAAD,CAAP,CAAWL,OAAX,CAAmB,UAAUI,IAAV,EAAgB;AAC/BL,YAAAA,MAAM,CAACG,IAAP,CAAYV,QAAQ,CAACY,IAAD,CAApB;AACH,WAFD;AAGH,SAJD;AAKH;AACJ,KArBD;;AAsBA,QAAIL,MAAM,CAACO,MAAP,GAAgB,CAApB,EAAuB;AACnB,WAAK3B,GAAL,CAASlB,WAAT,CAAqBsC,MAArB,EAA6B,KAAK5C,KAAL,CAAWoD,eAAX,IAA8B,EAA3D;AACH;AACJ,GAhCD;;AAiCAvD,EAAAA,WAAW,CAACW,SAAZ,CAAsB0B,YAAtB,GAAqC,YAAY;AAC7C,QAAI1C,MAAM,CAAC,KAAKQ,KAAL,CAAWgB,IAAZ,CAAN,IAA2BtB,WAAW,CAAC,KAAKM,KAAL,CAAWgB,IAAZ,CAA1C,EAA6D;AACzD,WAAKb,YAAL,GAAoB,IAApB;AACA,UAAIkD,WAAW,GAAG7D,MAAM,CAAC,KAAKQ,KAAL,CAAWgB,IAAZ,CAAN,GAA0BxB,MAA1B,GAAmCE,WAArD;AACA,WAAK+B,KAAL,GAAa,IAAI4B,WAAW,CAAC,KAAKrD,KAAL,CAAWgB,IAAZ,CAAf,CAAiC,KAAKhB,KAAL,CAAWkB,OAA5C,CAAb;AACA,WAAKY,IAAL,CAAUwB,QAAV,CAAmB,KAAK7B,KAAxB;AACH,KALD,MAMK;AACD8B,MAAAA,OAAO,CAACC,KAAR,CAAc,+BAA+B,KAAKxD,KAAL,CAAWgB,IAA1C,GAAiD,GAA/D;AACH;AACJ,GAVD;;AAWAnB,EAAAA,WAAW,CAACW,SAAZ,CAAsBiD,MAAtB,GAA+B,YAAY;AACvC,WAAO,IAAP;AACH,GAFD;;AAGA5D,EAAAA,WAAW,CAAC6D,WAAZ,GAA0B9D,YAAY,CAAC+D,WAAvC;AACA,SAAO9D,WAAP;AACH,CAjHgC,CAiH/BF,QAAQ,CAACiE,SAjHsB,CAAjC;;AAkHAxE,OAAO,CAACyE,OAAR,GAAkBhE,WAAlB","sourcesContent":["\"use strict\";\n/**\n * @file mapvgl可视化图层\n * @author hedongran\n * @email hdr01@126.com\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\n// @ts-ignore\nvar mapvgl = tslib_1.__importStar(require(\"mapvgl\"));\n// @ts-ignore\nvar mapvglThree = tslib_1.__importStar(require(\"mapvgl/dist/mapvgl.threelayers.min\"));\nvar common_1 = require(\"../common\");\nvar MapvglView_1 = require(\"./MapvglView\");\n;\n/**\n * 该组件将MapVGL的图层使用`react`进行了一层封装。具体关于MapVGL有哪些图层，以及图层的属性，请查阅[MapVGL文档](https://mapv.baidu.com/gl/docs/)\n * @visibleName MapvglLayer MapVGL图层\n */\nvar MapvglLayer = /** @class */ (function (_super) {\n    tslib_1.__extends(MapvglLayer, _super);\n    function MapvglLayer(props) {\n        var _this = _super.call(this, props) || this;\n        _this._createLayer = false;\n        var self = _this;\n        if (_this.props.getMethods) {\n            _this.props.getMethods({\n                setViewport: _this.setViewport.bind(self)\n            });\n        }\n        return _this;\n    }\n    MapvglLayer.prototype.componentDidMount = function () {\n        this.initialize();\n    };\n    MapvglLayer.prototype.componentWillUnmount = function () {\n        this.destroy();\n    };\n    MapvglLayer.prototype.componentDidUpdate = function (prevProps) {\n        var _a = this.props, type = _a.type, data = _a.data, options = _a.options, autoViewport = _a.autoViewport;\n        var preType = prevProps.type, preData = prevProps.data, preOptions = prevProps.options, preViewport = prevProps.autoViewport;\n        if (!this.map || !this.layer) {\n            this.initialize();\n            return;\n        }\n        if (type !== preType) {\n            this.destroy();\n            this.initialize();\n            return;\n        }\n        if (JSON.stringify(preOptions) !== JSON.stringify(options)) {\n            this.layer.setOptions(options);\n        }\n        if (JSON.stringify(preData) !== JSON.stringify(data)) {\n            this.layer.setData(data);\n        }\n        if (autoViewport && (JSON.stringify(preData) !== JSON.stringify(data) || autoViewport !== preViewport)) {\n            this.setViewport();\n        }\n    };\n    MapvglLayer.prototype.destroy = function () {\n        if (this.layer && this.view) {\n            this._createLayer = false;\n            this.view.removeLayer(this.layer);\n            this.layer.destroy();\n            // @ts-ignore\n            this.layer = null;\n        }\n    };\n    MapvglLayer.prototype.initialize = function () {\n        var map = this.map = this.getMap();\n        var view = this.view = this.props.view || this.context.view;\n        if (!map || !view) {\n            return;\n        }\n        if (!this._createLayer) {\n            this.createLayers();\n        }\n        this.layer.setData(this.props.data);\n        if (this.props.autoViewport) {\n            this.setViewport();\n        }\n    };\n    MapvglLayer.prototype.setViewport = function () {\n        var isMC = this.props.coordType === 'bd09mc';\n        var getPoint = function (coordinate) {\n            var p = new BMapGL.Point(coordinate[0], coordinate[1]);\n            return isMC ? BMapGL.Projection.convertMC2LL(p) : p;\n        };\n        var points = [];\n        this.props.data.forEach(function (data) {\n            if (data.geometry.type === 'Point') {\n                points.push(getPoint(data.geometry.coordinates));\n            }\n            else if (data.geometry.type === 'LineString') {\n                data.geometry.coordinates.forEach(function (item) {\n                    points.push(getPoint(item));\n                });\n            }\n            else if (data.geometry.type === 'Polygon') {\n                data.geometry.coordinates[0].forEach(function (item) {\n                    points.push(getPoint(item));\n                });\n            }\n            else if (data.geometry.type === 'MultiPolygon') {\n                data.geometry.coordinates.forEach(function (polygon) {\n                    polygon[0].forEach(function (item) {\n                        points.push(getPoint(item));\n                    });\n                });\n            }\n        });\n        if (points.length > 0) {\n            this.map.setViewport(points, this.props.viewportOptions || {});\n        }\n    };\n    MapvglLayer.prototype.createLayers = function () {\n        if (mapvgl[this.props.type] || mapvglThree[this.props.type]) {\n            this._createLayer = true;\n            var Constructor = mapvgl[this.props.type] ? mapvgl : mapvglThree;\n            this.layer = new Constructor[this.props.type](this.props.options);\n            this.view.addLayer(this.layer);\n        }\n        else {\n            console.error(\"mapvgl doesn't have layer \" + this.props.type + \"!\");\n        }\n    };\n    MapvglLayer.prototype.render = function () {\n        return null;\n    };\n    MapvglLayer.contextType = MapvglView_1.ViewContext;\n    return MapvglLayer;\n}(common_1.Component));\nexports.default = MapvglLayer;\n"]},"metadata":{},"sourceType":"script"}