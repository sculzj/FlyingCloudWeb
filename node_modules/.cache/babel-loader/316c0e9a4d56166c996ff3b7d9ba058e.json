{"ast":null,"code":"\"use strict\";\n/**\n * @file 异步加载JSAPI的高阶组件\n * @author hedongran [hdr01@126.com]\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar react_1 = tslib_1.__importStar(require(\"react\"));\n\nvar getDisplayName_1 = tslib_1.__importDefault(require(\"../utils/getDisplayName\"));\n/**\n * 异步加载JSAPI的高阶组件，在业务组件中使用，从而实现将JSAPI以异步形式插入，而不是提前放到`index.html`模板里。\n * @visibleName MapApiLoaderHOC 异步加载HOC\n */\n\n\nexports.default = function (hocProps) {\n  return function (WrappedComponent) {\n    var _a;\n\n    return _a =\n    /** @class */\n    function (_super) {\n      tslib_1.__extends(MapApiLoaderHOC, _super);\n\n      function MapApiLoaderHOC(props) {\n        var _this = _super.call(this, props) || this;\n\n        _this.state = {\n          loaded: _this.isLoadReady()\n        };\n        _this.loadJSAPI = _this.loadJSAPI.bind(_this);\n        _this.handleLoaded = _this.handleLoaded.bind(_this);\n        return _this;\n      }\n\n      MapApiLoaderHOC.prototype.isLoadReady = function () {\n        return !!(window.BMapGL && window.BMapGL.Map);\n      };\n\n      MapApiLoaderHOC.prototype.componentDidMount = function () {\n        if (!this.isLoadReady()) {\n          if (!hocProps.ak) {\n            throw new TypeError('MapApiLoaderHOC: ak is required');\n          }\n\n          this.loadJSAPI();\n        }\n      };\n\n      MapApiLoaderHOC.prototype.componentWillUnmount = function () {\n        if (this.apiTimer) {\n          clearTimeout(this.apiTimer);\n        }\n\n        if (this.loadedTimer) {\n          clearTimeout(this.loadedTimer);\n        }\n      };\n\n      MapApiLoaderHOC.prototype.loadJSAPI = function () {\n        var _this = this;\n\n        if (this.isLoadReady()) {\n          this.handleLoaded();\n          return;\n        }\n\n        if (window['loadingMap']) {\n          this.apiTimer = window.setTimeout(function () {\n            _this.loadJSAPI();\n          }, 300);\n        } else if (!window['MapApiLoaderCallback']) {\n          window['loadingMap'] = true;\n\n          window['MapApiLoaderCallback'] = function () {\n            delete window['loadingMap'];\n            delete window['MapApiLoaderCallback'];\n          };\n\n          var ak = hocProps.ak;\n          var script = document.createElement('script');\n          script.type = 'text/javascript';\n          script.src = \"//api.map.baidu.com/api?type=webgl&v=1.0&ak=\" + ak + \"&callback=MapApiLoaderCallback\";\n          document.body.appendChild(script);\n          this.loadedTimer = window.setTimeout(function () {\n            _this.handleLoaded();\n          }, 300);\n        }\n      };\n\n      MapApiLoaderHOC.prototype.handleLoaded = function () {\n        var _this = this;\n\n        if (!this.isLoadReady()) {\n          this.loadedTimer = window.setTimeout(function () {\n            _this.handleLoaded();\n          }, 300);\n          return;\n        }\n\n        this.setState({\n          loaded: true\n        });\n      };\n\n      MapApiLoaderHOC.prototype.render = function () {\n        var loaded = this.state.loaded;\n        return loaded ? react_1.default.createElement(WrappedComponent, tslib_1.__assign({}, this.props)) : react_1.default.createElement(\"div\", null, \"loading...\");\n      };\n\n      return MapApiLoaderHOC;\n    }(react_1.Component), _a.displayName = \"MapApiLoaderHOC(\" + getDisplayName_1.default(WrappedComponent) + \")\", _a;\n  };\n};","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Map/MapApiLoaderHOC.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","react_1","__importStar","getDisplayName_1","__importDefault","default","hocProps","WrappedComponent","_a","_super","__extends","MapApiLoaderHOC","props","_this","call","state","loaded","isLoadReady","loadJSAPI","bind","handleLoaded","prototype","window","BMapGL","Map","componentDidMount","ak","TypeError","componentWillUnmount","apiTimer","clearTimeout","loadedTimer","setTimeout","script","document","createElement","type","src","body","appendChild","setState","render","__assign","Component","displayName"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @file 异步加载JSAPI的高阶组件\n * @author hedongran [hdr01@126.com]\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\nvar react_1 = tslib_1.__importStar(require(\"react\"));\nvar getDisplayName_1 = tslib_1.__importDefault(require(\"../utils/getDisplayName\"));\n/**\n * 异步加载JSAPI的高阶组件，在业务组件中使用，从而实现将JSAPI以异步形式插入，而不是提前放到`index.html`模板里。\n * @visibleName MapApiLoaderHOC 异步加载HOC\n */\nexports.default = (function (hocProps) { return function (WrappedComponent) {\n    var _a;\n    return _a = /** @class */ (function (_super) {\n            tslib_1.__extends(MapApiLoaderHOC, _super);\n            function MapApiLoaderHOC(props) {\n                var _this = _super.call(this, props) || this;\n                _this.state = {\n                    loaded: _this.isLoadReady()\n                };\n                _this.loadJSAPI = _this.loadJSAPI.bind(_this);\n                _this.handleLoaded = _this.handleLoaded.bind(_this);\n                return _this;\n            }\n            MapApiLoaderHOC.prototype.isLoadReady = function () {\n                return !!(window.BMapGL && window.BMapGL.Map);\n            };\n            MapApiLoaderHOC.prototype.componentDidMount = function () {\n                if (!this.isLoadReady()) {\n                    if (!hocProps.ak) {\n                        throw new TypeError('MapApiLoaderHOC: ak is required');\n                    }\n                    this.loadJSAPI();\n                }\n            };\n            MapApiLoaderHOC.prototype.componentWillUnmount = function () {\n                if (this.apiTimer) {\n                    clearTimeout(this.apiTimer);\n                }\n                if (this.loadedTimer) {\n                    clearTimeout(this.loadedTimer);\n                }\n            };\n            MapApiLoaderHOC.prototype.loadJSAPI = function () {\n                var _this = this;\n                if (this.isLoadReady()) {\n                    this.handleLoaded();\n                    return;\n                }\n                if (window['loadingMap']) {\n                    this.apiTimer = window.setTimeout(function () {\n                        _this.loadJSAPI();\n                    }, 300);\n                }\n                else if (!window['MapApiLoaderCallback']) {\n                    window['loadingMap'] = true;\n                    window['MapApiLoaderCallback'] = function () {\n                        delete window['loadingMap'];\n                        delete window['MapApiLoaderCallback'];\n                    };\n                    var ak = hocProps.ak;\n                    var script = document.createElement('script');\n                    script.type = 'text/javascript';\n                    script.src = \"//api.map.baidu.com/api?type=webgl&v=1.0&ak=\" + ak + \"&callback=MapApiLoaderCallback\";\n                    document.body.appendChild(script);\n                    this.loadedTimer = window.setTimeout(function () {\n                        _this.handleLoaded();\n                    }, 300);\n                }\n            };\n            MapApiLoaderHOC.prototype.handleLoaded = function () {\n                var _this = this;\n                if (!this.isLoadReady()) {\n                    this.loadedTimer = window.setTimeout(function () {\n                        _this.handleLoaded();\n                    }, 300);\n                    return;\n                }\n                this.setState({\n                    loaded: true\n                });\n            };\n            MapApiLoaderHOC.prototype.render = function () {\n                var loaded = this.state.loaded;\n                return (loaded\n                    ? react_1.default.createElement(WrappedComponent, tslib_1.__assign({}, this.props))\n                    : react_1.default.createElement(\"div\", null, \"loading...\"));\n            };\n            return MapApiLoaderHOC;\n        }(react_1.Component)),\n        _a.displayName = \"MapApiLoaderHOC(\" + getDisplayName_1.default(WrappedComponent) + \")\",\n        _a;\n}; });\n"]},"metadata":{},"sourceType":"script"}