{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\"); // @ts-ignore\n\n\nvar mapvgl_1 = require(\"mapvgl\");\n\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\n\nvar common_1 = require(\"../common\");\n\nvar DEFAULT_COLOR = 'rgba(60, 50, 200, 0.9)';\n/**\n * 根据起终点地名或者坐标，自动生成2D弧线，可用于OD等场景的效果展示\n * @visibleName Arc 2D弧线\n */\n\nvar Arc =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(Arc, _super);\n\n  function Arc(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this._createLayer = false;\n    return _this;\n  }\n\n  Arc.prototype.componentDidMount = function () {\n    this.initialize();\n  };\n\n  Arc.prototype.componentDidUpdate = function (prevProps) {\n    if (!shallowequal_1.default(this.props, prevProps)) {\n      this.initialize();\n    }\n  };\n\n  Arc.prototype.componentWillUnmount = function () {\n    this.destroy();\n  };\n\n  Arc.prototype.destroy = function () {\n    this._createLayer = false;\n    this.view.destroy(); // @ts-ignore\n\n    this.view = undefined; // @ts-ignore\n\n    this.linelayer = undefined; // @ts-ignore\n\n    this.arrowlayer = undefined; // @ts-ignore\n\n    this.flowlayer = undefined; // @ts-ignore\n\n    this.pointlayer = undefined; // @ts-ignore\n\n    this.textlayer = undefined;\n  };\n\n  Arc.prototype.initialize = function () {\n    var _this = this;\n\n    var map = this.map = this.getMap();\n\n    if (!map) {\n      return;\n    }\n\n    if (!this._createLayer) {\n      this.createLayers();\n    }\n\n    var lineData = [];\n    var pointData = [];\n    var arrowMap = new Map();\n\n    if (this.props.data) {\n      var points_1 = [];\n      var curve_1 = new mapvgl_1.OdCurve();\n      this.props.data.forEach(function (item) {\n        var start = item.from.point || mapvgl_1.utilCity.getCenterByCityName(item.from.city);\n        var end = item.to.point || mapvgl_1.utilCity.getCenterByCityName(item.to.city);\n        start = new BMapGL.Point(start.lng, start.lat);\n        end = new BMapGL.Point(end.lng, end.lat);\n        curve_1.setOptions({\n          points: [start, end]\n        });\n        var curveModelData = curve_1.getPoints();\n\n        if (_this.props.coordType === 'bd09mc') {\n          points_1.push(BMapGL.Projection.convertMC2LL(start));\n          points_1.push(BMapGL.Projection.convertMC2LL(end));\n        } else {\n          points_1.push(start);\n          points_1.push(end);\n        }\n\n        lineData.push({\n          geometry: {\n            type: 'LineString',\n            coordinates: curveModelData\n          },\n          color: item.color\n        });\n        var arrowData = arrowMap.get(item.color) || [];\n        arrowData.push({\n          geometry: {\n            type: 'LineString',\n            coordinates: curveModelData\n          }\n        });\n        arrowMap.set(item.color, arrowData);\n\n        if (_this.props.showEndPoint !== false) {\n          pointData.push({\n            geometry: {\n              type: 'Point',\n              coordinates: [end.lng, end.lat]\n            },\n            color: item.color,\n            properties: {\n              text: item.to.name || item.to.city\n            }\n          });\n        }\n\n        if (_this.props.showStartPoint !== false) {\n          pointData.push({\n            geometry: {\n              type: 'Point',\n              coordinates: [start.lng, start.lat]\n            },\n            color: item.color,\n            properties: {\n              text: item.from.name || item.from.city\n            }\n          });\n        }\n\n        if (points_1.length > 0) {\n          if (_this.props.autoViewport === true) {\n            map.setViewport(points_1, _this.props.viewportOptions || {});\n          }\n        }\n      });\n    }\n\n    this.linelayer.setData(lineData);\n\n    if (this.props.lineOptions) {\n      this.linelayer.setOptions(this.props.lineOptions);\n    }\n\n    this.pointlayer.setData(pointData);\n\n    if (this.props.pointOptions) {\n      this.pointlayer.setOptions(this.props.pointOptions);\n    }\n\n    this.textlayer.setData(pointData);\n\n    if (this.props.textOptions) {\n      this.textlayer.setOptions(this.props.textOptions);\n    } // 如果data中指定了颜色，则单独new一个箭头颜色匹配的LineLayer\n\n\n    Array.from(arrowMap.keys()).forEach(function (color) {\n      if (color === undefined) {\n        _this.arrowlayer.setData(arrowMap.get(undefined));\n\n        _this.props.arrowOptions && _this.arrowlayer.setOptions(_this.props.arrowOptions);\n      } else {\n        var colorarrowlayer = new mapvgl_1.LineLayer(tslib_1.__assign(tslib_1.__assign({\n          width: 10\n        }, _this.props.arrowOptions), {\n          style: 'arrow',\n          color: 'rgba(255, 255, 255, 0)',\n          styleOptions: {\n            color: color\n          }\n        }));\n\n        _this.view.addLayer(colorarrowlayer);\n\n        colorarrowlayer.setData(arrowMap.get(color));\n      }\n    });\n\n    if (this.props.enableAnimation) {\n      this.flowlayer.setData(lineData);\n      this.props.animationOptions && this.flowlayer.setOptions(this.props.animationOptions);\n    }\n  };\n\n  Arc.prototype.createLayers = function () {\n    this._createLayer = true;\n    var map = this.map;\n    var view = this.view = new mapvgl_1.View({\n      map: map\n    });\n    var linelayer = this.linelayer = new mapvgl_1.LineLayer({\n      blend: 'ligher',\n      color: DEFAULT_COLOR,\n      width: 4\n    });\n    view.addLayer(linelayer);\n    var arrowlayer = this.arrowlayer = new mapvgl_1.LineLayer({\n      width: 10,\n      style: 'arrow',\n      color: 'rgba(255, 255, 255, 0)',\n      styleOptions: {\n        color: DEFAULT_COLOR\n      }\n    });\n    view.addLayer(arrowlayer);\n    var pointlayer = this.pointlayer = new mapvgl_1.PointLayer({\n      blend: 'ligher',\n      depthTest: false,\n      color: DEFAULT_COLOR,\n      size: 10\n    });\n    view.addLayer(pointlayer);\n    var textlayer = this.textlayer = new mapvgl_1.TextLayer({\n      offset: [0, 15],\n      depthTest: false,\n      color: '#333'\n    });\n    view.addLayer(textlayer);\n    var flowlayer = this.flowlayer = new mapvgl_1.LineFlowLayer({\n      color: function () {\n        return 'rgb(240, 200, 200)';\n      },\n      polygonOffset: [-2, -2],\n      interval: 0.4,\n      duration: 1,\n      trailLength: 0.8\n    });\n    view.addLayer(flowlayer);\n  };\n\n  Arc.prototype.render = function () {\n    return null;\n  };\n\n  Arc.defaultProps = {\n    enableAnimation: true,\n    showStartPoint: true,\n    showEndPoint: true\n  };\n  return Arc;\n}(common_1.Component);\n\nexports.default = Arc;","map":{"version":3,"sources":["D:/WebStorm Project/flowingcloud/node_modules/react-bmapgl/Custom/Arc.js"],"names":["Object","defineProperty","exports","value","tslib_1","require","mapvgl_1","shallowequal_1","__importDefault","common_1","DEFAULT_COLOR","Arc","_super","__extends","props","_this","call","_createLayer","prototype","componentDidMount","initialize","componentDidUpdate","prevProps","default","componentWillUnmount","destroy","view","undefined","linelayer","arrowlayer","flowlayer","pointlayer","textlayer","map","getMap","createLayers","lineData","pointData","arrowMap","Map","data","points_1","curve_1","OdCurve","forEach","item","start","from","point","utilCity","getCenterByCityName","city","end","to","BMapGL","Point","lng","lat","setOptions","points","curveModelData","getPoints","coordType","push","Projection","convertMC2LL","geometry","type","coordinates","color","arrowData","get","set","showEndPoint","properties","text","name","showStartPoint","length","autoViewport","setViewport","viewportOptions","setData","lineOptions","pointOptions","textOptions","Array","keys","arrowOptions","colorarrowlayer","LineLayer","__assign","width","style","styleOptions","addLayer","enableAnimation","animationOptions","View","blend","PointLayer","depthTest","size","TextLayer","offset","LineFlowLayer","polygonOffset","interval","duration","trailLength","render","defaultProps","Component"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tslib_1 = require(\"tslib\");\n// @ts-ignore\nvar mapvgl_1 = require(\"mapvgl\");\nvar shallowequal_1 = tslib_1.__importDefault(require(\"shallowequal\"));\nvar common_1 = require(\"../common\");\nvar DEFAULT_COLOR = 'rgba(60, 50, 200, 0.9)';\n/**\n * 根据起终点地名或者坐标，自动生成2D弧线，可用于OD等场景的效果展示\n * @visibleName Arc 2D弧线\n */\nvar Arc = /** @class */ (function (_super) {\n    tslib_1.__extends(Arc, _super);\n    function Arc(props) {\n        var _this = _super.call(this, props) || this;\n        _this._createLayer = false;\n        return _this;\n    }\n    Arc.prototype.componentDidMount = function () {\n        this.initialize();\n    };\n    Arc.prototype.componentDidUpdate = function (prevProps) {\n        if (!shallowequal_1.default(this.props, prevProps)) {\n            this.initialize();\n        }\n    };\n    Arc.prototype.componentWillUnmount = function () {\n        this.destroy();\n    };\n    Arc.prototype.destroy = function () {\n        this._createLayer = false;\n        this.view.destroy();\n        // @ts-ignore\n        this.view = undefined;\n        // @ts-ignore\n        this.linelayer = undefined;\n        // @ts-ignore\n        this.arrowlayer = undefined;\n        // @ts-ignore\n        this.flowlayer = undefined;\n        // @ts-ignore\n        this.pointlayer = undefined;\n        // @ts-ignore\n        this.textlayer = undefined;\n    };\n    Arc.prototype.initialize = function () {\n        var _this = this;\n        var map = this.map = this.getMap();\n        if (!map) {\n            return;\n        }\n        if (!this._createLayer) {\n            this.createLayers();\n        }\n        var lineData = [];\n        var pointData = [];\n        var arrowMap = new Map();\n        if (this.props.data) {\n            var points_1 = [];\n            var curve_1 = new mapvgl_1.OdCurve();\n            this.props.data.forEach(function (item) {\n                var start = item.from.point || mapvgl_1.utilCity.getCenterByCityName(item.from.city);\n                var end = item.to.point || mapvgl_1.utilCity.getCenterByCityName(item.to.city);\n                start = new BMapGL.Point(start.lng, start.lat);\n                end = new BMapGL.Point(end.lng, end.lat);\n                curve_1.setOptions({\n                    points: [start, end]\n                });\n                var curveModelData = curve_1.getPoints();\n                if (_this.props.coordType === 'bd09mc') {\n                    points_1.push(BMapGL.Projection.convertMC2LL(start));\n                    points_1.push(BMapGL.Projection.convertMC2LL(end));\n                }\n                else {\n                    points_1.push(start);\n                    points_1.push(end);\n                }\n                lineData.push({\n                    geometry: {\n                        type: 'LineString',\n                        coordinates: curveModelData\n                    },\n                    color: item.color\n                });\n                var arrowData = arrowMap.get(item.color) || [];\n                arrowData.push({\n                    geometry: {\n                        type: 'LineString',\n                        coordinates: curveModelData\n                    }\n                });\n                arrowMap.set(item.color, arrowData);\n                if (_this.props.showEndPoint !== false) {\n                    pointData.push({\n                        geometry: {\n                            type: 'Point',\n                            coordinates: [end.lng, end.lat]\n                        },\n                        color: item.color,\n                        properties: {\n                            text: item.to.name || item.to.city\n                        }\n                    });\n                }\n                if (_this.props.showStartPoint !== false) {\n                    pointData.push({\n                        geometry: {\n                            type: 'Point',\n                            coordinates: [start.lng, start.lat]\n                        },\n                        color: item.color,\n                        properties: {\n                            text: item.from.name || item.from.city\n                        }\n                    });\n                }\n                if (points_1.length > 0) {\n                    if (_this.props.autoViewport === true) {\n                        map.setViewport(points_1, _this.props.viewportOptions || {});\n                    }\n                }\n            });\n        }\n        this.linelayer.setData(lineData);\n        if (this.props.lineOptions) {\n            this.linelayer.setOptions(this.props.lineOptions);\n        }\n        this.pointlayer.setData(pointData);\n        if (this.props.pointOptions) {\n            this.pointlayer.setOptions(this.props.pointOptions);\n        }\n        this.textlayer.setData(pointData);\n        if (this.props.textOptions) {\n            this.textlayer.setOptions(this.props.textOptions);\n        }\n        // 如果data中指定了颜色，则单独new一个箭头颜色匹配的LineLayer\n        Array.from(arrowMap.keys()).forEach(function (color) {\n            if (color === undefined) {\n                _this.arrowlayer.setData(arrowMap.get(undefined));\n                _this.props.arrowOptions && _this.arrowlayer.setOptions(_this.props.arrowOptions);\n            }\n            else {\n                var colorarrowlayer = new mapvgl_1.LineLayer(tslib_1.__assign(tslib_1.__assign({ width: 10 }, _this.props.arrowOptions), { style: 'arrow', color: 'rgba(255, 255, 255, 0)', styleOptions: {\n                        color: color\n                    } }));\n                _this.view.addLayer(colorarrowlayer);\n                colorarrowlayer.setData(arrowMap.get(color));\n            }\n        });\n        if (this.props.enableAnimation) {\n            this.flowlayer.setData(lineData);\n            this.props.animationOptions && this.flowlayer.setOptions(this.props.animationOptions);\n        }\n    };\n    Arc.prototype.createLayers = function () {\n        this._createLayer = true;\n        var map = this.map;\n        var view = this.view = new mapvgl_1.View({\n            map: map\n        });\n        var linelayer = this.linelayer = new mapvgl_1.LineLayer({\n            blend: 'ligher',\n            color: DEFAULT_COLOR,\n            width: 4\n        });\n        view.addLayer(linelayer);\n        var arrowlayer = this.arrowlayer = new mapvgl_1.LineLayer({\n            width: 10,\n            style: 'arrow',\n            color: 'rgba(255, 255, 255, 0)',\n            styleOptions: {\n                color: DEFAULT_COLOR\n            }\n        });\n        view.addLayer(arrowlayer);\n        var pointlayer = this.pointlayer = new mapvgl_1.PointLayer({\n            blend: 'ligher',\n            depthTest: false,\n            color: DEFAULT_COLOR,\n            size: 10\n        });\n        view.addLayer(pointlayer);\n        var textlayer = this.textlayer = new mapvgl_1.TextLayer({\n            offset: [0, 15],\n            depthTest: false,\n            color: '#333'\n        });\n        view.addLayer(textlayer);\n        var flowlayer = this.flowlayer = new mapvgl_1.LineFlowLayer({\n            color: function () { return 'rgb(240, 200, 200)'; },\n            polygonOffset: [-2, -2],\n            interval: 0.4,\n            duration: 1,\n            trailLength: 0.8\n        });\n        view.addLayer(flowlayer);\n    };\n    Arc.prototype.render = function () {\n        return null;\n    };\n    Arc.defaultProps = {\n        enableAnimation: true,\n        showStartPoint: true,\n        showEndPoint: true\n    };\n    return Arc;\n}(common_1.Component));\nexports.default = Arc;\n"]},"metadata":{},"sourceType":"script"}